<!DOCTYPE html>
<html lang="ko">
    {% extends "base.html" %}
{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ file_info.file.subject }}</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
        }
        .image-gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .image-gallery img {
            display : block;
            margin : auto;
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }
        .fixed-actions {
            position: fixed;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
        }
        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            margin-bottom: 10px;
            border-radius: 50%;
            background: #ddd;
            color: #333;
            text-align: center;
            line-height: 50px;
            text-decoration: none;
            border: none; 
            font-size: 14px; 
        }
        /* ì´ëª¨ì§€ì™€ ìˆ«ì ì‚¬ì´ì˜ ê°„ê²©ì„ ì¶”ê°€í•©ë‹ˆë‹¤ */
        .likes-count {
            margin-top: -33px; 
        } 
        .like_ic {
            margin-top:6px; 
        } 
        h1{
            margin-top:30px;
        }
        
        .comment-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 10px;
        }
    
        .comment-content {
            margin-bottom: 10px; /* ëŒ“ê¸€ ë‚´ìš©ê³¼ ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²© */
        }
    
        .comment-author {
            display : inline-block;
            font-weight: bold;
            margin-bottom: 5px; /* ì‘ì„±ì ì´ë¦„ê³¼ ëŒ“ê¸€ ë‚´ìš© ì‚¬ì´ì˜ ê°„ê²© */
        }
    
        .comment-date {
            display : inline-block;
            margin-left : 5px;
            font-size : 0.5em;
            margin-bottom: 5px; /* ì‘ì„±ì ì´ë¦„ê³¼ ëŒ“ê¸€ ë‚´ìš© ì‚¬ì´ì˜ ê°„ê²© */
        }
    
        .comment-footer {
            display: flex;
            justify-content: flex-end; /* ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì •ë ¬ */
        }
    
        .comment-footer a {
            margin-left: 5px; /* ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²© */
        }
    
        .comment-footer a:first-child {
            margin-left: 0; /* ì²« ë²ˆì§¸ ë²„íŠ¼ì˜ ì™¼ìª½ ì—¬ë°± ì œê±° */
        }
        .comment-section {
            border-top: 1px solid #ddd;
            padding-top: 20px;
            margin-top: 20px;
        }
        
        .comment-form {
            display: block;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .comment-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .comment-form button {
            float: right;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .comment-form button:hover {
            background-color: #0056b3;
        }
        .file-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .file-title {
            display:flex;
            margin-top : 70px;
            font-size: 3em;
            font-weight: bold;
        }

        .file-meta {
            display: inline-block;
            align-items: center;
            font-size: 0.9em;
            color: #0000000;
        }

        .file-meta span {
            margin-right: 15px;
        }

        .more-info {
            cursor: pointer;
            width: 20px;
            height: 20px;
            border: 1px solid #000;
            border-radius: 50%;
            display: inline-block;
            text-align: center;
            line-height: 18px; /* Adjust line height to vertically center the dots inside the circle */
            vertical-align: middle; /* Align the icon vertically */
            font-size: 20px;
            color: #000;
            text-decoration: none;
        }
        
        .more-info:hover {
            text-decoration: none;
            background-color: #f0f0f0;
        }
        
        
        .hidden-info {
            display: none;
        }
        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ì€ ìœ ì§€í•˜ë©´ì„œ ì¶”ê°€ */
.comment-section {
    margin: auto;
}

.comment-card {
    width: 100%; /* ëŒ“ê¸€ ì¹´ë“œì˜ ë„ˆë¹„ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤ */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* ì„ íƒì ìœ¼ë¡œ ê·¸ë¦¼ì íš¨ê³¼ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ */
    margin-bottom: 20px; /* ëŒ“ê¸€ ì¹´ë“œ ì‚¬ì´ì˜ ê°„ê²© */
}

.comment-form {
    width: 100%; /* í¼ì˜ ë„ˆë¹„ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤ */
    margin-top: 20px; /* í¼ê³¼ ì´ì „ ìš”ì†Œ ì‚¬ì´ì˜ ê°„ê²© */
}

.comment-form textarea {
    width: calc(100% - 20px); /* íŒ¨ë”©ì„ ê³ ë ¤í•˜ì—¬ ë„ˆë¹„ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤ */
    margin-bottom: 10px; /* ë²„íŠ¼ê³¼ì˜ ê°„ê²© */
}

.comment-form button {
    width: auto; /* ë²„íŠ¼ì˜ ë„ˆë¹„ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤ */
    padding: 10px 20px;
}

/* ëŒ“ê¸€ í¼ê³¼ ë“±ë¡ ë²„íŠ¼ì„ ìœ„í•œ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
.form-group {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.form-count{
    margin-top : 30px;
}

.form-group .btn {
    margin-left: 10px; /* ë²„íŠ¼ê³¼ ì…ë ¥ í•„ë“œ ì‚¬ì´ì˜ ê°„ê²© */
}

/* ëª¨ë°”ì¼ í™”ë©´ì— ëŒ€í•œ ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .form-group {
        flex-direction: column;
        align-items: stretch;
    }

    .form-group .btn {
        width: 100%; /* ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ë²„íŠ¼ì˜ ë„ˆë¹„ë¥¼ 100%ë¡œ ì¡°ì • */
        margin-top: 10px; /* ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²© */
    }
}
.btn-primary{
    margin-bottom : 50px;
}

    </style>
</head>
<body>
    
    <div class="container">
        <div class="file-header">
            <div>
                <div class="file-meta">
                    {%if file_info.file.modify_date%}
                        <div class="file-title">{{ file_info.file.subject }}</div>
                        <span>{{ file_info.file.author }}</span>
                        <span>{{file_info.file.modify_date|date:"Y. m. d. H:i" }}(ìˆ˜ì •ë¨)</span>
    
    
                    {%else%}
                         <div class="file-title">{{ file_info.file.subject }}</div>
                         <span>{{ file_info.file.author }}</span>
                         <span>{{ file_info.file.create_date|date:"Y. m. d. H:i" }}</span>
                         
     
                    {% endif %}
                
                  
                </div>
            </div>
            <div class="file-actions">
                {% if request.user == file_info.file.author %}
                    <a href="{% url 'app:file_modify' file_info.file.id %}" class="btn btn-sm btn-outline-secondary">ìˆ˜ì •</a>
                    <a href="#" class="delete btn btn-sm btn-outline-secondary" data-uri="{% url 'app:file_delete' file_info.file.id %}">ì‚­ì œ</a>
                {% endif %}
            </div>
        </div>
        <span>{{ file_info.file.content}}</span>
    </div>
        <div class="container">
            
        
        <div class="image-gallery">
            {% for image_path in file_info.image_url %}
            <img src="{{ image_path }}" alt="PDF page image">
            {% endfor %}
        </div>
    </div>

    <div class="fixed-actions">
        <a href="#comment-create" class="action-button">ğŸ’¬</a>
        <a href="javascript:void(0)" class="action-button" onclick="toggleLike({{ file_info.file.id }})">
            {% if request.user in file_info.file.voter.all %}
            <span class="like_ic">â¤ï¸</span>
            <span class="likes-count">{{ file_info.file.likes }}</span>
            {% else %}
            <span class="like_ic">ğŸ¤</span>
            <span class="likes-count">{{ file_info.file.likes }}</span>
            {% endif %}
            
        </a>

        
        
        <a href="javascript:void(0)" class="action-button" onclick="copyCurrentUrl()">ğŸ”—</a>
    </div>
    <div class = "container">
        <label for="content" class="form-count">ëŒ“ê¸€ : {{comments.count}}</label>
        <hr>
        
        {% for comment in comments %}
        <div class="comment-card">
            <div class="comment-author">{{ comment.author.username }}</div> 
            {%if comment.modify_date%}
            <div class = "comment-date"> {{comment.modify_date|date:"Y. m. d. H:i" }}(ìˆ˜ì •ë¨)</div>
            {%else%}
            <div class = "comment-date"> {{comment.creation_date|date:"Y. m. d. H:i" }}</div>
            {%endif%}
            <div class="comment-content">{{ comment.content }}</div>
            <div class="comment-footer">
                {% if request.user == comment.author %}
                    <a href="{% url 'app:comment_modify' comment.id %}" class="btn btn-sm btn-outline-secondary">ìˆ˜ì •</a>
                    <a href="#" class="delete btn btn-sm btn-outline-secondary" data-uri="{% url 'app:comment_delete' comment.id %}">ì‚­ì œ</a>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        
    </div>
    <div class="container" id="comment-create">
    <form action="{% url 'app:comment_create' file_info.file.id %}" method="post" class="comment-form">
        {% csrf_token %}
        {% if form.errors %}
            <div class="alert alert-danger" role="alert">
                <ul>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li><strong> ëŒ“ê¸€ë‚´ìš© :</strong>  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        
        <div class="mb-3">
            <label for="content" class="form-label">ëŒ“ê¸€ë‚´ìš©</label>
            <textarea {% if not user.is_authenticated %}disabled{% endif %} name="content" id="content" class="form-control" rows="4">{{ form.content.value }}</textarea>
        </div>
        <button type="submit" class="btn btn-primary">ë“±ë¡</button>
    </form>
</div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script >
        function copyCurrentUrl() {
            // í˜„ì¬ URLì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const url = window.location.href;

            // í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•˜ê¸° ìœ„í•œ ì„ì‹œ í…ìŠ¤íŠ¸ ì˜ì—­ì„ ìƒì„±í•©ë‹ˆë‹¤.
            const textArea = document.createElement("textarea");
            textArea.value = url;
            document.body.appendChild(textArea);

            // í…ìŠ¤íŠ¸ ì˜ì—­ì„ ì„ íƒí•©ë‹ˆë‹¤.
            textArea.select();

            // ì„ íƒëœ í…ìŠ¤íŠ¸ë¥¼ í´ë¦½ë³´ë“œì— ë³µì‚¬í•©ë‹ˆë‹¤.
            document.execCommand("copy");

            // ì„ì‹œ í…ìŠ¤íŠ¸ ì˜ì—­ì„ ì œê±°í•©ë‹ˆë‹¤.
            document.body.removeChild(textArea);

            // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ í‘œì‹œí•©ë‹ˆë‹¤. (ì˜µì…˜)
            alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤");
        }

        function toggleLike(fileId) {
            $.ajax({
                url: '/app/like_file/' + fileId+'/', // Django URL ê²½ë¡œì— ë§ê²Œ ì¡°ì •
                type: 'POST',
                data: {
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                    'file_id': fileId,
                },
                success: function(response) {
                    // ì„œë²„ë¡œë¶€í„° ì‘ë‹µì„ ë°›ìœ¼ë©´ ì¢‹ì•„ìš” ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
                    if(response.liked) {
                        $('.like_ic').text('â¤ï¸');
                    } else {
                        $('.like_ic').text('ğŸ¤');
                    }
                    $('.likes-count').text(response.likes);
                },
                error: function(xhr, status, error) {
                    console.error("AJAX ìš”ì²­ ì‹¤íŒ¨: ", status, error);
                }
            });
            
        }
        const delete_elements = document.getElementsByClassName("delete");
                Array.from(delete_elements).forEach(function (element) {
                    element.addEventListener("click", function () {
                        if (confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                            location.href = this.dataset.uri;
                        }
                });
            });
            
            
    </script>
    
</body> 
{% endblock %}
</html>
